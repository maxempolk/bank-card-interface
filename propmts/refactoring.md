# Задача: Рефакторинг Next.js/React кода

Проанализируй прикрепленный код и выполни его рефакторинг согласно следующим требованиям:

## 1. Декомпозиция и структура файлов

### Разбиение компонентов:
- Выдели переиспользуемые UI-компоненты в отдельные файлы (кнопки, инпуты, карточки и т.д.)
- Создай композитные компоненты для сложных UI-блоков
- Раздели компоненты по принципу Single Responsibility
- Размер компонента не должен превышать 200-250 строк

### Структура директорий:
```
/components
  /ui           # переиспользуемые UI-компоненты
  /features     # функциональные компоненты
  /layout       # компоненты лейаута
/lib            # утилиты и хелперы
/hooks          # кастомные хуки
/types          # TypeScript типы
/constants      # константы
/services       # API сервисы
/utils          # вспомогательные функции
```

### Выдели в отдельные файлы:
- Бизнес-логику в кастомные хуки
- API запросы в сервисные функции
- Типы и интерфейсы в type-файлы
- Константы и конфигурации
- Валидационные схемы
- Утилитарные функции

## 2. Проверка критических ошибок и багов

### Обязательно проверь:
- **Memory leaks**: неочищенные subscriptions, таймеры, listeners
- **Race conditions**: некорректная работа с async/await
- **Infinite loops**: бесконечные ре-рендеры в useEffect
- **Missing dependencies**: в массивах зависимостей хуков
- **Unhandled promises**: отсутствие обработки ошибок в async функциях
- **Key prop issues**: некорректные или отсутствующие ключи в списках
- **State mutations**: прямое изменение state вместо иммутабельных обновлений
- **Prop drilling**: излишняя передача пропсов через множество компонентов
- **Missing error boundaries**: отсутствие обработки ошибок
- **Accessibility issues**: отсутствие aria-атрибутов, семантической разметки

## 3. Best Practices для Next.js/React

### Производительность:
- Используй React.memo() для предотвращения лишних ре-рендеров
- Применяй useCallback и useMemo где необходимо
- Реализуй lazy loading для тяжелых компонентов (dynamic import)
- Оптимизируй изображения через next/image
- Используй Server Components где возможно (Next.js 13+)

### Типизация (TypeScript):
- Добавь строгую типизацию для всех компонентов
- Используй интерфейсы для props
- Типизируй все хуки и функции
- Избегай 'any', используй 'unknown' где нужно

### State Management:
- Используй локальный state для UI-состояний
- Применяй Context API для глобального состояния (если нет сложного state)
- Рассмотри Zustand/Redux для сложного state management
- Используй Server State библиотеки (React Query/SWR) для серверных данных

### Code Quality:
- Следуй принципам DRY (Don't Repeat Yourself)
- Применяй SOLID принципы где применимо
- Используй composition over inheritance
- Пиши чистые функции без side effects
- Добавь JSDoc комментарии для сложной логики

### Next.js специфика:
- Правильно используй App Router vs Pages Router
- Оптимизируй использование getServerSideProps/getStaticProps
- Настрой правильный кеширование через fetch или headers
- Используй middleware для общей логики
- Применяй route handlers для API endpoints

### Безопасность:
- Валидируй все входящие данные
- Используй environment variables для секретов
- Защити API routes от CSRF
- Санитизируй пользовательский ввод
- Используй HTTPS для production

## 4. Формат ответа

Предоставь:
1. **Список найденных критических ошибок** с объяснением
2. **План рефакторинга** - какие файлы создать и как организовать
3. **Рефакторенный код** для каждого файла
4. **Пояснения** к ключевым изменениям
5. **Рекомендации** по дальнейшему улучшению

Начни с анализа кода и выявления проблем, затем переходи к рефакторингу.